name: CI

on: [push, pull_request]

jobs:
  build:
    name: Scala ${{ matrix.scala }}, Java ${{ matrix.java }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        java: [1.8, 1.11, 1.14]
        scala: [2.12.11, 2.13.1]
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: ${{ matrix.java }}
    - name: Cache Coursier
      uses: actions/cache@v1
      with:
        path: ~/.cache/coursier
        key: sbt-coursier-cache
    - name: Cache SBT
      uses: actions/cache@v1
      with:
        path: ~/.sbt
        key: sbt-${{ hashFiles('**/build.sbt') }}
    - name: Check formatting
      if: (matrix.java == '1.8')
      run: sbt ++${{ matrix.scala }} scalafmtCheckAll
    - name: Check Binary Compatability 
      run: sbt ++${{ matrix.scala }} mimaReportBinaryIssues
    - name: Check unused dependencies
      run: sbt ++$SCALA_VERSION unusedCompileDependenciesTest
    - name: Test
      run: sbt ++${{ matrix.scala }} test
    - name: Scaladoc
      run: sbt ++$SCALA_VERSION doc
